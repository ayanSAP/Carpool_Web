<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Driver Route</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- CSS -->
    <link rel="stylesheet" href="css/styles-driver-route.css" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="fav-img/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="fav-img/favicon.ico" type="image/x-icon" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300&amp;display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/a7e82826af.js"
      crossorigin="anonymous"
    ></script>

    <!-- Google Maps -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
  </head>
  <body>
    <nav class="navbar">
      <span class="navbar-toggle" id="js-navbar-toggle">
        <i class="fa-solid fa-bars" style="color: #000000"></i>
      </span>
      <div class="logo-image">
        <div class="image-left">
          <img src="images/carpoolLogo.png" alt="" />
        </div>
        <div class="logo-right">
          <a href="#" class="logo">SAP Ride</a>
        </div>
      </div>
      <ul class="main-nav" id="js-menu">
        <li>
          <a href="index.html" class="nav-links">Home</a>
        </li>
        <li>
          <a href="about-page.html" class="nav-links">About</a>
        </li>
        <li>
          <a href="contact.html" class="nav-links">Contact</a>
        </li>
        <li>
          <a href="news.html" class="nav-links">News</a>
        </li>
        <li>
          <a href="login.html" class="nav-links">Login</a>
        </li>
      </ul>
    </nav>

    <!-- Body part -->
    <div class="container">
      <form id="form_id">
        <img
          src="images/DriverRoute.png"
          alt="DriverRouteImage"
          class="DriverRouteImage"
        />
        <div class="form-group">
          <input
            type="text"
            id="leaving-from"
            name="leaving-from"
            placeholder="● Leaving from..."
          />
          <input type="hidden" name="lat" />

          <input type="hidden" name="long" />

          <input
            type="text"
            id="going-to"
            name="going-to"
            placeholder="● Going to..."
          />
          <input type="datetime-local" id="datetime" name="datetime" />
          <div class="input-with-icon">
            <i class="fa-solid fa-user"></i>
            <input
              type="number"
              id="passenger-count"
              name="passenger-count"
              value="1"
              min="1"
            />
          </div>
          <!-- <button type="submit" id="search">Search</button> -->
          <input type="button" name="search" id="search" value="Search" />
        </div>
      </form>
      <div class="info">
        <h1>Welcome dear Users</h1>
        <p>
          We're excited to introduce you to a seamless solution for making your
          daily commute an enjoyable and collaborative experience. Designed
          specifically for employees who drive their own cars, this page allows
          you to take charge of your journey while fostering a sense of
          camaraderie with your colleagues.
          <br />
          <br />With our user-friendly interface, you can easily input your
          starting point and destination, along with the date and time you're
          heading to work. We've made it effortless for you to share your
          commuting details and offer a helping hand to your fellow coworkers
          who are seeking a reliable carpooling service. But that's not all! Our
          carpooling app allows you to specify the number of passengers you can
          comfortably accommodate in your car. By doing so, you're not just
          providing a convenient ride to your colleagues, but you're also
          contributing to a more sustainable and eco-friendly way of commuting.
          <br />
          <br />Join us on this exciting carpooling journey and let's make your
          work commute more efficient, enjoyable, and socially responsible than
          ever before! Together, we can transform the way we travel and create a
          positive impact on our workplace community.
        </p>
      </div>

      <div class="table">
        <h1>Found Rides</h1>
        <div class="floatLeft">
          <table class="show" id="show">
            <tr>
              <th>Leaving from</th>
              <th>Going to</th>
              <th>Date/ Time</th>
              <th>Seat Availability</th>
            </tr>
            <tr></tr>
          </table>
        </div>
        <div class="floatRight">
          <table>
            <tr>
              <th>Map</th>
              <th>Request Ride</th>
              <th>Driver Info</th>
            </tr>
            <tr>
              <td>
                <button class="button button1" id="show" onclick="show()">
                  View
                </button>
              </td>
              <td>
                <button class="button button1" id="modal-btn">
                  Request Ride
                </button>
              </td>
              <td>
                <button class="button button1" id="modal-btn-2">
                  View Driver
                </button>
              </td>
            </tr>
          </table>
        </div>
      </div>

      <!-- MODAL CLASS -->
      <!-- MODAL CLASS REQUEST RIDE -->
      <div class="modal" id="my-modal">
        <div class="modal-content">
          <div class="modal-header">
            <span class="close">&times;</span>
            <h2>Your Ride has been successfully requested!</h2>
          </div>
          <div class="modal-body">
            <p>Thank you for using SAP Ride</p>
          </div>
        </div>
      </div>

      <!-- Modal Class Driver Info -->
      <div class="modal-2" id="my-modal-2">
        <div class="modal-content-2">
          <div class="modal-header-2">
            <span class="close-2">&times;</span>
            <h2>Driver Information</h2>
          </div>
          <div class="modal-body-2">
            <!-- CSS Table -->
            <table class="table1">
              <thead>
                <th>Full Name</th>
                <th>Email</th>
                <th>Contact Number</th>
                <th>Car Details</th>
              </thead>
              <tbody id="tbody1"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <div class="footer_container">
        <div class="footer_content">
          <p>
            &copy;
            <script>
              document.write(new Date().getFullYear());
            </script>
          </p>
          <img src="images/icons8-sap-48.png" alt="SAP Logo" />
        </div>
      </div>
    </div>

    <!-- JS -->

    <script src="js/driver-route.js"></script>

    <!-- prettier-ignore -->
    <script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyAxm8FkvFET5RlgfeYejEccc2Q19P9BOM4"></script>

    <script type="module">
      // --------------GOOGLE MAPS AUTOCOMPLETE-------------
      google.maps.event.addDomListener(window, "load", initialize);

      function initialize() {
        var inputLeaving = document.getElementById("leaving-from");
        var inputGoing = document.getElementById("going-to");

        var autocompleteLeaving = new google.maps.places.Autocomplete(
          inputLeaving
        );
        var autocompleteGoing = new google.maps.places.Autocomplete(inputGoing);

        autocompleteLeaving.addListener("place_changed", function () {
          var place = autocompleteLeaving.getPlace();

          // place variable will have all the information you are looking for.

          $("#lat").val(place.geometry["location"].lat());

          $("#long").val(place.geometry["location"].lng());
        });

        autocompleteGoing.addListener("place_changed", function () {
          var place = autocompleteGoing.getPlace();

          // place variable will have all the information you are looking for.

          $("#lat").val(place.geometry["location"].lat());

          $("#long").val(place.geometry["location"].lng());
        });
      }

      // MODAL STRUCTURE REQUEST RIDE

      // Get DOM Elements
      const modal = document.querySelector("#my-modal");
      const modalDriver = document.querySelector("#my-modal-2");

      const modalBtn = document.querySelector("#modal-btn");
      const modalBtnDriver = document.querySelector("#modal-btn-2");

      const closeBtn = document.querySelector(".close");
      const closeBtnDriver = document.querySelector(".close-2");

      // Events
      modalBtn.addEventListener("click", openModal);
      modalBtnDriver.addEventListener("click", openModal2);

      closeBtn.addEventListener("click", closeModal);
      closeBtnDriver.addEventListener("click", closeModal2);

      window.addEventListener("click", outsideClick);
      window.addEventListener("click", outsideClick2);

      // Open Modal Request
      function openModal() {
        modal.style.display = "block";
      }

      // Open Modal Driver
      function openModal2() {
        modalDriver.style.display = "block";
      }

      // Close Model Request
      function closeModal() {
        modal.style.display = "none";
      }

      // Close Model Driver
      function closeModal2() {
        modalDriver.style.display = "none";
      }

      // Close If Outside Click for Request Modal
      function outsideClick(e) {
        if (e.target == modal) {
          modal.style.display = "none";
        }
      }

      // Close If Outside Click for Driver Info
      function outsideClick2(e) {
        if (e.target == modalDriver) {
          modalDriver.style.display = "none";
        }
      }

      // FILLING THE TABLE FROM FIREBASE
      // Firebase
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        child,
        onValue,
        get,
      } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-database.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBqzmB5cPsejDGpxgJsD-_ZfBs17uGoeiE",
        authDomain: "ridepublish.firebaseapp.com",
        databaseURL: "https://ridepublish-default-rtdb.firebaseio.com",
        projectId: "ridepublish",
        storageBucket: "ridepublish.appspot.com",
        messagingSenderId: "145760624915",
        appId: "1:145760624915:web:f75564f3f2d89b68d1bae6",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);

      const db = getDatabase();

      // ---------------------FILLING THE TABLE---------------------//
      var tbody = document.getElementById("tbody1");
      function AddItemToTable(name, email, contact, details) {
        let trow = document.createElement("tr");
        let td1 = document.createElement("td");
        let td2 = document.createElement("td");
        let td3 = document.createElement("td");
        let td4 = document.createElement("td");

        td1.innerHTML = name;
        td2.innerHTML = email;
        td3.innerHTML = contact;
        td4.innerHTML = details;

        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4);

        tbody.appendChild(trow);
      }

      function AddAllItemsToTable(TheDrivers) {
        tbody.innerHTML = "";
        TheDrivers.forEach((element) => {
          AddItemToTable(
            element.Full_name,
            element.Email,
            element.Contact_no,
            element.Car_Details
          );
        });
      }

      function GetAllDataRealTime() {
        const dbRef = ref(db, "drivers/");

        onValue(dbRef, (snapshot) => {
          var drivers = [];
          snapshot.forEach((element) => {
            drivers.push(element.val());
          });

          AddAllItemsToTable(drivers);
        });
      }

      window.onload = GetAllDataRealTime;
    </script>
  </body>
</html>
